---
title: "Authentication"
description: "User authentication setup and usage guide"
---

## Overview

Zephyra uses **Firebase Authentication** to securely manage user sign-in, token validation, and identity management.  
The backend verifies Firebase ID tokens in each request to protect API routes and ensure trusted access.

---

## Configuration

Make sure you have enabled **Firebase Authentication** in your Firebase project.

<Steps>

### Set up Firebase credentials

In your Firebase console, go to:

> **Build → Authentication → Sign-in method**

Enable the desired providers (e.g., **Email/Password**, **Google**, or **Custom token**).

### Add service account key

Place your Firebase **Admin SDK JSON** file in the project root as:

```
serviceAccountKey.json
```

Update your `.env` file:

```bash
FIREBASE_ADMIN_JSON=./serviceAccountKey.json
```

### Initialize Firebase Admin SDK

Zephyra automatically initializes Firebase using this file:

```ts
// src/config/firebase.ts
import admin from 'firebase-admin'
import path from 'path'

const serviceAccountPath = process.env.FIREBASE_ADMIN_JSON
  ? path.resolve(process.env.FIREBASE_ADMIN_JSON)
  : null

if (!admin.apps.length && serviceAccountPath) {
  admin.initializeApp({
    credential: admin.credential.cert(serviceAccountPath),
  })
}

export const db = admin.firestore()
export const auth = admin.auth()
```

</Steps>

---

## Authentication Flow

Here’s how authentication works in Zephyra:

<Columns cols={2}>
  <Card
    title="Client Side"
    icon="user"
  >
    The frontend (e.g., Nuxt or React app) signs in users using Firebase SDK and obtains an **ID Token**.
  </Card>

  <Card
    title="Server Side"
    icon="server"
  >
    Every API request includes the ID token in the `Authorization` header.  
    The backend verifies it using Firebase Admin SDK.
  </Card>
</Columns>

---

## Middleware Protection

Protected routes use an `authMiddleware` that verifies Firebase tokens:

```ts
// src/middleware/authMiddleware.ts
import type { Request, Response, NextFunction } from "express";
import admin from "firebase-admin";

export const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split("Bearer ")[1];
  if (!token) return res.status(401).json({ message: "Unauthorized" });

  try {
    const decodedToken = await admin.auth().verifyIdToken(token);
    (req as any).user = decodedToken;
    next();
  } catch {
    res.status(401).json({ message: "Invalid or expired token" });
  }
};
```

Then apply it in your routes:

```ts
import { authMiddleware } from "../middleware/authMiddleware";

router.get("/user/profile", authMiddleware, getUserProfile);
```

---

## Testing Authentication

To test protected routes locally:

1. Sign in a user with Firebase SDK and get an **ID token**.
2. Include it in your API request headers:

```bash
curl -H "Authorization: Bearer <YOUR_ID_TOKEN>" http://localhost:5000/api/user/profile
```

You should receive a successful JSON response if the token is valid.

---

## Token Refresh

Firebase automatically refreshes tokens in the client SDK.
However, ensure your frontend handles re-authentication when tokens expire or the user logs out.

---

## Summary

| Component        | Purpose                                  |
| ---------------- | ---------------------------------------- |
| Firebase Auth    | Handles user identity and tokens         |
| `authMiddleware` | Verifies token on backend routes         |
| `Admin SDK`      | Provides server-side access to user info |
| `.env`           | Defines the credentials path             |

---

## Learn More

<Card
    title="Next: Role-based access control (RBAC)"
    icon="lock"
    href="/authentication/rbac"
>
    Learn how to extend Firebase Authentication with custom roles and permissions.
</Card>
